{"ast":null,"code":"var _jsxFileName = \"D:\\\\GIT\\\\1\\u0441-extensions-info\\\\frontend\\\\src\\\\services\\\\contexWebSocket.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WS_URL = process.env.REACT_WS_URL || 'http://localhost:8080/api/v1/ws';\nconst WebSocketContext = /*#__PURE__*/createContext(null);\nexport const WebSocketProvider = ({\n  children\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const wsRef = useRef(null);\n  const heartbeatRef = useRef(null);\n  useEffect(() => {\n    console.log(WS_URL);\n    const ws = new WebSocket(WS_URL); // Ñ‚Ð²Ð¾Ð¹ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚\n    wsRef.current = ws;\n    ws.onopen = () => {\n      console.log(\"âœ… WS connected\");\n      // Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ keepalive\n      heartbeatRef.current = setInterval(() => {\n        if (ws.readyState === WebSocket.OPEN) {\n          ws.send(JSON.stringify({\n            type: \"ping\"\n          }));\n        }\n      }, 30000); // ÐºÐ°Ð¶Ð´Ñ‹Ðµ 30 ÑÐµÐº\n    };\n    ws.onmessage = event => {\n      setMessages(prev => [...prev, event.data]);\n    };\n    ws.onerror = err => {\n      console.error(\"âŒ WS error\", err);\n    };\n    ws.onclose = () => {\n      console.log(\"ðŸ”Œ WS closed\");\n      clearInterval(heartbeatRef.current);\n      // Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ reconnect Ñ‡ÐµÑ€ÐµÐ· setTimeout(...)\n    };\n    return () => {\n      ws.close();\n      clearInterval(heartbeatRef.current);\n    };\n  }, []);\n  const sendMessage = msg => {\n    var _wsRef$current;\n    if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(msg));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(WebSocketContext.Provider, {\n    value: {\n      messages,\n      sendMessage\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 9\n  }, this);\n};\n_s(WebSocketProvider, \"dSf6Oa72/O0WmqOWhhn6O+jYtLw=\");\n_c = WebSocketProvider;\nexport const useWebSocket = () => {\n  _s2();\n  return useContext(WebSocketContext);\n};\n_s2(useWebSocket, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"WebSocketProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useRef","useState","jsxDEV","_jsxDEV","WS_URL","process","env","REACT_WS_URL","WebSocketContext","WebSocketProvider","children","_s","messages","setMessages","wsRef","heartbeatRef","console","log","ws","WebSocket","current","onopen","setInterval","readyState","OPEN","send","JSON","stringify","type","onmessage","event","prev","data","onerror","err","error","onclose","clearInterval","close","sendMessage","msg","_wsRef$current","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useWebSocket","_s2","$RefreshReg$"],"sources":["D:/GIT/1Ñ-extensions-info/frontend/src/services/contexWebSocket.js"],"sourcesContent":["\r\nimport React, { createContext, useContext, useEffect, useRef, useState } from 'react';\r\n\r\nconst WS_URL = process.env.REACT_WS_URL || 'http://localhost:8080/api/v1/ws';\r\nconst WebSocketContext = createContext(null);\r\n\r\nexport const WebSocketProvider = ({ children }) => {\r\n    const [messages, setMessages] = useState([]);\r\n    const wsRef = useRef(null);\r\n    const heartbeatRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        console.log(WS_URL)\r\n        const ws = new WebSocket(WS_URL); // Ñ‚Ð²Ð¾Ð¹ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n            console.log(\"âœ… WS connected\");\r\n            // Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ keepalive\r\n            heartbeatRef.current = setInterval(() => {\r\n                if (ws.readyState === WebSocket.OPEN) {\r\n                    ws.send(JSON.stringify({ type: \"ping\" }));\r\n                }\r\n            }, 30_000); // ÐºÐ°Ð¶Ð´Ñ‹Ðµ 30 ÑÐµÐº\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            setMessages((prev) => [...prev, event.data]);\r\n        };\r\n\r\n        ws.onerror = (err) => {\r\n            console.error(\"âŒ WS error\", err);\r\n        };\r\n\r\n        ws.onclose = () => {\r\n            console.log(\"ðŸ”Œ WS closed\");\r\n            clearInterval(heartbeatRef.current);\r\n            // Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ reconnect Ñ‡ÐµÑ€ÐµÐ· setTimeout(...)\r\n        };\r\n\r\n        return () => {\r\n            ws.close();\r\n            clearInterval(heartbeatRef.current);\r\n        };\r\n    }, []);\r\n\r\n    const sendMessage = (msg) => {\r\n        if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify(msg));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <WebSocketContext.Provider value={{ messages, sendMessage }}>\r\n            {children}\r\n        </WebSocketContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useWebSocket = () => useContext(WebSocketContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}