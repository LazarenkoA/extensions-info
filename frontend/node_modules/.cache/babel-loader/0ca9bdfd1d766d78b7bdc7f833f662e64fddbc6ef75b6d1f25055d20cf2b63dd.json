{"ast":null,"code":"var _jsxFileName = \"D:\\\\GIT\\\\1\\u0441-extensions-info\\\\frontend\\\\src\\\\services\\\\contexWebSocket.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WS_URL = process.env.REACT_WS_URL || 'http://localhost:8080/ws';\nconst WebSocketContext = /*#__PURE__*/createContext(null);\nexport const WebSocketProvider = ({\n  children\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const wsRef = useRef(null);\n  const heartbeatRef = useRef(null);\n  useEffect(() => {\n    const ws = new WebSocket(WS_URL); // твой эндпоинт\n    wsRef.current = ws;\n    ws.onopen = () => {\n      console.log(\"✅ WS connected\");\n      // запускаем keepalive\n      heartbeatRef.current = setInterval(() => {\n        if (ws.readyState === WebSocket.OPEN) {\n          ws.send(JSON.stringify({\n            type: \"ping\"\n          }));\n        }\n      }, 30000); // каждые 30 сек\n    };\n    ws.onmessage = event => {\n      console.log(\"📩 WS message:\", event.data);\n      setMessages(prev => [...prev, event.data]);\n    };\n    ws.onerror = err => {\n      console.error(\"❌ WS error\", err);\n    };\n    ws.onclose = () => {\n      console.log(\"🔌 WS closed\");\n      clearInterval(heartbeatRef.current);\n      // можно добавить reconnect через setTimeout(...)\n    };\n    return () => {\n      ws.close();\n      clearInterval(heartbeatRef.current);\n    };\n  }, []);\n  const sendMessage = msg => {\n    var _wsRef$current;\n    if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(msg));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(WebSocketContext.Provider, {\n    value: {\n      messages,\n      sendMessage\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 9\n  }, this);\n};\n_s(WebSocketProvider, \"dSf6Oa72/O0WmqOWhhn6O+jYtLw=\");\n_c = WebSocketProvider;\nexport const useWebSocket = () => {\n  _s2();\n  return useContext(WebSocketContext);\n};\n_s2(useWebSocket, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"WebSocketProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useRef","useState","jsxDEV","_jsxDEV","WS_URL","process","env","REACT_WS_URL","WebSocketContext","WebSocketProvider","children","_s","messages","setMessages","wsRef","heartbeatRef","ws","WebSocket","current","onopen","console","log","setInterval","readyState","OPEN","send","JSON","stringify","type","onmessage","event","data","prev","onerror","err","error","onclose","clearInterval","close","sendMessage","msg","_wsRef$current","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useWebSocket","_s2","$RefreshReg$"],"sources":["D:/GIT/1с-extensions-info/frontend/src/services/contexWebSocket.js"],"sourcesContent":["\r\nimport React, { createContext, useContext, useEffect, useRef, useState } from 'react';\r\n\r\nconst WS_URL = process.env.REACT_WS_URL || 'http://localhost:8080/ws';\r\nconst WebSocketContext = createContext(null);\r\n\r\nexport const WebSocketProvider = ({ children }) => {\r\n    const [messages, setMessages] = useState([]);\r\n    const wsRef = useRef(null);\r\n    const heartbeatRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const ws = new WebSocket(WS_URL); // твой эндпоинт\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n            console.log(\"✅ WS connected\");\r\n            // запускаем keepalive\r\n            heartbeatRef.current = setInterval(() => {\r\n                if (ws.readyState === WebSocket.OPEN) {\r\n                    ws.send(JSON.stringify({ type: \"ping\" }));\r\n                }\r\n            }, 30_000); // каждые 30 сек\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            console.log(\"📩 WS message:\", event.data);\r\n            setMessages((prev) => [...prev, event.data]);\r\n        };\r\n\r\n        ws.onerror = (err) => {\r\n            console.error(\"❌ WS error\", err);\r\n        };\r\n\r\n        ws.onclose = () => {\r\n            console.log(\"🔌 WS closed\");\r\n            clearInterval(heartbeatRef.current);\r\n            // можно добавить reconnect через setTimeout(...)\r\n        };\r\n\r\n        return () => {\r\n            ws.close();\r\n            clearInterval(heartbeatRef.current);\r\n        };\r\n    }, []);\r\n\r\n    const sendMessage = (msg) => {\r\n        if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify(msg));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <WebSocketContext.Provider value={{ messages, sendMessage }}>\r\n            {children}\r\n        </WebSocketContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useWebSocket = () => useContext(WebSocketContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}