{"ast":null,"code":"import _objectSpread from\"D:/GIT/go-react-fullstack/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useMutation,useQueryClient}from'@tanstack/react-query';import{createUser,updateUser}from'../services/userService';import'./UserModal.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserModal=_ref=>{let{user,onClose}=_ref;const[formData,setFormData]=useState({name:'',email:'',age:''});const[errors,setErrors]=useState({});const queryClient=useQueryClient();const isEditing=!!user;useEffect(()=>{if(user){setFormData({name:user.name,email:user.email,age:user.age.toString()});}},[user]);const createMutation=useMutation({mutationFn:createUser,onSuccess:()=>{queryClient.invalidateQueries(['users']);onClose();},onError:error=>{console.error('Ошибка создания:',error);}});const updateMutation=useMutation({mutationFn:_ref2=>{let{id,userData}=_ref2;return updateUser(id,userData);},onSuccess:()=>{queryClient.invalidateQueries(['users']);onClose();},onError:error=>{console.error('Ошибка обновления:',error);}});const validateForm=()=>{const newErrors={};if(!formData.name.trim()){newErrors.name='Имя обязательно';}else if(formData.name.length<2){newErrors.name='Имя должно содержать минимум 2 символа';}if(!formData.email.trim()){newErrors.email='Email обязателен';}else if(!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)){newErrors.email='Некорректный формат email';}if(!formData.age){newErrors.age='Возраст обязателен';}else if(isNaN(formData.age)||formData.age<0||formData.age>120){newErrors.age='Возраст должен быть числом от 0 до 120';}setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=e=>{e.preventDefault();if(!validateForm()){return;}const userData={name:formData.name.trim(),email:formData.email.trim(),age:parseInt(formData.age)};if(isEditing){updateMutation.mutate({id:user.id,userData});}else{createMutation.mutate(userData);}};const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));// Очищаем ошибку для поля при вводе\nif(errors[name]){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:''}));}};return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:isEditing?'Редактировать пользователя':'Создать пользователя'}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:onClose,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"user-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"name\",children:\"\\u0418\\u043C\\u044F:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"name\",name:\"name\",value:formData.name,onChange:handleChange,className:errors.name?'error':''}),errors.name&&/*#__PURE__*/_jsx(\"span\",{className:\"error-text\",children:errors.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Email:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",name:\"email\",value:formData.email,onChange:handleChange,className:errors.email?'error':'',disabled:isEditing// Email нельзя изменить при редактировании\n}),errors.email&&/*#__PURE__*/_jsx(\"span\",{className:\"error-text\",children:errors.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"age\",children:\"\\u0412\\u043E\\u0437\\u0440\\u0430\\u0441\\u0442:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",id:\"age\",name:\"age\",value:formData.age,onChange:handleChange,className:errors.age?'error':'',min:\"0\",max:\"120\"}),errors.age&&/*#__PURE__*/_jsx(\"span\",{className:\"error-text\",children:errors.age})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"btn btn-secondary\",children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:createMutation.isLoading||updateMutation.isLoading,children:createMutation.isLoading||updateMutation.isLoading?'Сохранение...':isEditing?'Обновить':'Создать'})]})]})]})});};export default UserModal;","map":{"version":3,"names":["React","useState","useEffect","useMutation","useQueryClient","createUser","updateUser","jsx","_jsx","jsxs","_jsxs","UserModal","_ref","user","onClose","formData","setFormData","name","email","age","errors","setErrors","queryClient","isEditing","toString","createMutation","mutationFn","onSuccess","invalidateQueries","onError","error","console","updateMutation","_ref2","id","userData","validateForm","newErrors","trim","length","test","isNaN","Object","keys","handleSubmit","e","preventDefault","parseInt","mutate","handleChange","value","target","prev","_objectSpread","className","onClick","children","stopPropagation","onSubmit","htmlFor","type","onChange","disabled","min","max","isLoading"],"sources":["D:/GIT/go-react-fullstack/frontend/src/components/UserModal.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { createUser, updateUser } from '../services/userService';\nimport './UserModal.css';\n\nconst UserModal = ({ user, onClose }) => {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    age: '',\n  });\n  const [errors, setErrors] = useState({});\n\n  const queryClient = useQueryClient();\n  const isEditing = !!user;\n\n  useEffect(() => {\n    if (user) {\n      setFormData({\n        name: user.name,\n        email: user.email,\n        age: user.age.toString(),\n      });\n    }\n  }, [user]);\n\n  const createMutation = useMutation({\n    mutationFn: createUser,\n    onSuccess: () => {\n      queryClient.invalidateQueries(['users']);\n      onClose();\n    },\n    onError: (error) => {\n      console.error('Ошибка создания:', error);\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, userData }) => updateUser(id, userData),\n    onSuccess: () => {\n      queryClient.invalidateQueries(['users']);\n      onClose();\n    },\n    onError: (error) => {\n      console.error('Ошибка обновления:', error);\n    },\n  });\n\n  const validateForm = () => {\n    const newErrors = {};\n\n    if (!formData.name.trim()) {\n      newErrors.name = 'Имя обязательно';\n    } else if (formData.name.length < 2) {\n      newErrors.name = 'Имя должно содержать минимум 2 символа';\n    }\n\n    if (!formData.email.trim()) {\n      newErrors.email = 'Email обязателен';\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = 'Некорректный формат email';\n    }\n\n    if (!formData.age) {\n      newErrors.age = 'Возраст обязателен';\n    } else if (isNaN(formData.age) || formData.age < 0 || formData.age > 120) {\n      newErrors.age = 'Возраст должен быть числом от 0 до 120';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      return;\n    }\n\n    const userData = {\n      name: formData.name.trim(),\n      email: formData.email.trim(),\n      age: parseInt(formData.age),\n    };\n\n    if (isEditing) {\n      updateMutation.mutate({ id: user.id, userData });\n    } else {\n      createMutation.mutate(userData);\n    }\n  };\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n\n    // Очищаем ошибку для поля при вводе\n    if (errors[name]) {\n      setErrors(prev => ({\n        ...prev,\n        [name]: ''\n      }));\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\" onClick={onClose}>\n      <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2>{isEditing ? 'Редактировать пользователя' : 'Создать пользователя'}</h2>\n          <button className=\"close-btn\" onClick={onClose}>×</button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"user-form\">\n          <div className=\"form-group\">\n            <label htmlFor=\"name\">Имя:</label>\n            <input\n              type=\"text\"\n              id=\"name\"\n              name=\"name\"\n              value={formData.name}\n              onChange={handleChange}\n              className={errors.name ? 'error' : ''}\n            />\n            {errors.name && <span className=\"error-text\">{errors.name}</span>}\n          </div>\n\n          <div className=\"form-group\">\n            <label htmlFor=\"email\">Email:</label>\n            <input\n              type=\"email\"\n              id=\"email\"\n              name=\"email\"\n              value={formData.email}\n              onChange={handleChange}\n              className={errors.email ? 'error' : ''}\n              disabled={isEditing} // Email нельзя изменить при редактировании\n            />\n            {errors.email && <span className=\"error-text\">{errors.email}</span>}\n          </div>\n\n          <div className=\"form-group\">\n            <label htmlFor=\"age\">Возраст:</label>\n            <input\n              type=\"number\"\n              id=\"age\"\n              name=\"age\"\n              value={formData.age}\n              onChange={handleChange}\n              className={errors.age ? 'error' : ''}\n              min=\"0\"\n              max=\"120\"\n            />\n            {errors.age && <span className=\"error-text\">{errors.age}</span>}\n          </div>\n\n          <div className=\"form-actions\">\n            <button type=\"button\" onClick={onClose} className=\"btn btn-secondary\">\n              Отмена\n            </button>\n            <button \n              type=\"submit\" \n              className=\"btn btn-primary\"\n              disabled={createMutation.isLoading || updateMutation.isLoading}\n            >\n              {createMutation.isLoading || updateMutation.isLoading \n                ? 'Сохранение...' \n                : isEditing ? 'Обновить' : 'Создать'\n              }\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default UserModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}